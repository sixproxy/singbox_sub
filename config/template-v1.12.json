{
  "subs": [
    {"url": "", "prefix": "", "insecure": false}
  ]
  ,"log": { "disabled": false, "level": "warn", "timestamp": true},

  "experimental": {
    "clash_api": {
      "external_controller": "", "external_ui": "/etc/sing-box/ui", "secret": "", "external_ui_download_detour": "DirectConn", "default_mode": "rule",
      "external_ui_download_url": "https://ghfast.top/https://github.com/MetaCubeX/Yacd-meta/archive/gh-pages.zip"
    },
    "cache_file": { "enabled": true,  "path": "/etc/sing-box/cache.db"}
  },

  "dns":
  {
    "servers":
    [
      {"tag": "dns_local","type": "udp", "server": "114.114.114.114"},
      {"tag": "dns_proxy", "type": "https", "server": "8.8.8.8", "detour": "DNS"}
    ],
    "rules":
    [
      {"clash_mode": "Direct", "server": "dns_local"},
      {"clash_mode": "Global", "server": "dns_proxy"},
      {"rule_set": "geosite-cn", "server": "dns_local"},
      {"rule_set": "geosite-geolocation-!cn", "server": "dns_proxy"}
    ],
    "final": "dns_proxy", "strategy": "prefer_ipv4", "disable_cache": false, "disable_expire": false, "independent_cache": false,
    "client_subnet": "202.101.170.1/24"
  },

  "inbounds": [
    { "type": "tproxy", "tag": "tproxy-in", "listen": "::", "listen_port": 7895, "udp_timeout": "5m"}
  ],

  "outbounds": [
    { "tag": "ChainProxy", "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["sec_"] }]},
    { "tag": "DNS",         "type": "selector",  "outbounds":     ["AutoSelect","ChainProxy", "block"],"interrupt_exist_connections": true},
    { "tag": "NodeSelect",   "type": "selector", "outbounds":   ["AutoSelect", "ChainProxy","HK", "JP", "Select", "DirectConn"], "default":"AutoSelect","interrupt_exist_connections": true},
    { "tag": "YouTube",     "type": "selector", "outbounds":  ["HK","NodeSelect","ChainProxy", "Select","AutoSelect"],"default":"HK","interrupt_exist_connections": true},
    { "tag": "OpenAI",      "type": "selector", "outbounds":   ["JP","NodeSelect","ChainProxy", "Select","AutoSelect"] , "default":"JP", "interrupt_exist_connections": true},
    { "tag": "Google",      "type": "selector", "outbounds":   ["US","NodeSelect","ChainProxy", "Select","AutoSelect"] ,"default":"NodeSelect","interrupt_exist_connections": true },
    { "tag": "Github",      "type": "selector", "outbounds":   ["SG","NodeSelect","ChainProxy", "Select","AutoSelect", "DirectConn"],"default":"NodeSelect", "interrupt_exist_connections": true},
    { "tag": "Telegram",    "type": "selector", "outbounds": ["NodeSelect","ChainProxy", "Select",  "AutoSelect"], "default":"AutoSelect"},
    { "tag": "Others",     "type": "selector", "outbounds":  ["NodeSelect","ChainProxy", "AutoSelect", "HK", "JP","DirectConn"], "default":"AutoSelect"},
    { "tag": "Microsoft",   "type": "selector", "outbounds": ["SG","NodeSelect", "ChainProxy",  "DirectConn"] },
    { "tag": "Apple",       "type": "selector", "outbounds": ["DirectConn","AutoSelect" ] },
    { "tag": "Paypal",      "type": "selector", "outbounds": ["ChainProxy", "Select", "AutoSelect","DirectConn"]},
    { "tag": "Netflix",     "type": "selector", "outbounds": ["ChainProxy", "Select", "AutoSelect","DirectConn"]},
    { "tag": "Douyin",      "type": "selector", "outbounds": ["DirectConn","block"]  },
    { "tag": "WeChatVideo", "type": "selector", "outbounds": ["DirectConn","block"]  },
    { "tag": "HoK",         "type": "selector", "outbounds": ["HK","JP","SG"] },
    { "tag": "AutoSelect",  "type": "urltest",  "outbounds": ["{all}"], "filter": [{ "action": "exclude", "keywords": ["网站|地址|剩余|过期|时间|有效|官网|流量|sec"] }], "url": "https://cp.cloudflare.com/generate_204", "interval": "8m", "tolerance": 150 },
    { "tag": "Select",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "exclude", "keywords": ["网站|地址|剩余|过期|时间|有效|官网|流量|sec"] }]},
    { "tag": "DirectConn",  "type": "direct" },
    { "tag": "JP",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["日本"] }] , "default":"日本 06" },
    { "tag": "HK",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["香港"] }] , "default":"香港 06" },
    { "tag": "US",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["美國"] }] , "default":"美國 06" },
    { "tag": "SG",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["獅城"] }] , "default":"獅城 06" },
    { "tag": "UK",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["英國"] }] , "default":"英國 01" },
    { "tag": "TW",      "type": "selector", "outbounds": ["{all}"], "filter": [{ "action": "include", "keywords": ["台灣"] }] , "default":"台灣 06" },
    { "type": "socks", "tag": "block", "server": "0.0.0.0", "server_port": 1080}
  ],

  "route":
  {

    "default_domain_resolver": { "server": "dns_local", "rewrite_tll": 60, "client_subnet": "202.101.170.1/24"},
    "auto_detect_interface": true,
    "final": "Others",
    "default_mark": 1,
    "rules":
    [
      {"action": "sniff"     , "timeout": "1s"},
      {"action": "hijack-dns", "type": "logical", "mode": "or", "rules": [{"port": 53}, {"protocol": "dns"}]},
      {"ip_is_private": true, "outbound": "DirectConn"},
      {"action": "reject"    , "rule_set": ["geosite-ad1"]},
      {"action": "reject"    , "protocol": "quic"},
      {"action": "route"     , "rule_set": "geosite-douyin" , "outbound": "Douyin"},
      {"action": "route"     , "rule_set": "geosite-wx-shortvideo", "outbound": "WeChatVideo"},
      {"action": "route"     , "protocol": "ssh",        "outbound": "DirectConn"},
      {"action": "route"     , "protocol": "bittorrent", "outbound": "DirectConn"},
      {"action": "route"     , "clash_mode": "direct", "outbound": "DirectConn"},
      {"action": "route"     , "clash_mode": "global", "outbound": "AutoSelect"},
      {"action": "route"     , "rule_set": "geosite-hok", "outbound": "HoK"},
      {"action": "route"     , "domain": ["clash.razord.top", "yacd.metacubex.one", "yacd.haishan.me", "d.metacubex.one"], "outbound": "DirectConn"},
      {"action": "route"     , "domain_suffix": ["z-lib.gs","missav.com","missav.ws"], "outbound": "NodeSelect"},
      {"action": "route"     , "domain_suffix": ["okex.com", "okx.com", "oklink.com", "okx-dns.com", "okx-dns1.com", "okx-dns2.com", "binance.com","binance.info","binancecnt.com"], "outbound": "DirectConn"},
      {"action": "route"     , "rule_set": "geosite-ctm_cn", "outbound": "DirectConn"},
      {"action": "route"     , "rule_set": "geosite-private", "outbound": "DirectConn"},
      {"action": "route"     , "rule_set": "geosite-chat", "domain_suffix": ["grok.com"], "outbound": "OpenAI"},
      {"action": "route"     , "rule_set": "geosite-youtube", "outbound": "YouTube"},
      {"action": "route"     , "rule_set": "geosite-github", "outbound": "Github"},
      {"action": "route"     , "rule_set": ["geosite-google", "geoip-google"], "outbound": "Google"},
      {"action": "route"     , "rule_set": ["geosite-telegram", "geoip-telegram"], "outbound": "Telegram"},
      {"action": "route"     , "rule_set": ["geosite-apple", "geoip-apple"], "outbound": "Apple"},
      {"action": "route"     , "rule_set": "geosite-microsoft", "outbound": "Microsoft"},
      {"action": "route"     , "rule_set": "geosite-paypal", "outbound": "Paypal"},
      {"action": "route"     , "rule_set": "geosite-netflix", "outbound": "Netflix"},
      {"action": "route"     , "rule_set": "geosite-geolocation-!cn", "outbound": "NodeSelect"},
      {"action": "route"     , "rule_set": ["geoip-cn", "geosite-cn"], "outbound": "DirectConn"}
    ],

    "rule_set": [
      {	"tag": "geosite-ad1",             "type": "remote", "format": "binary", "url": "https://ghfast.top/https://github.com/Toperlock/sing-box-geosite/raw/main/rule/adservers.srs", "download_detour": "DirectConn"},
      {	"tag": "geosite-ad2",             "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/privacy-protection-tools/anti-ad.github.io/master/docs/anti-ad-sing-box.srs", "download_detour": "DirectConn"},
      {	"tag": "geosite-ctm_cn",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://github.com/sixproxy/rulesets/raw/refs/heads/main/rule/direct_cn.srs", "download_detour": "DirectConn"},
      { "tag": "geosite-chat",            "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/category-ai-chat-!cn.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-youtube",         "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/youtube.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-google",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/google.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-github",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/github.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-telegram",        "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/telegram.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-tiktok",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/tiktok.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-netflix",         "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/netflix.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-apple",           "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/apple.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-microsoft",       "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/microsoft.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-onedrive",        "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/onedrive.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-geolocation-!cn", "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/geolocation-!cn.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-cn",              "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/cn.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-private",         "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/private.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-google",            "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geoip/google.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-telegram",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geoip/telegram.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-netflix",           "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geoip/netflix.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-apple",             "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo-lite/geoip/apple.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-cn",                "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geoip/cn.srs", "download_detour": "DirectConn" },
      { "tag": "geoip-private",           "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geoip/private.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-wx-shortvideo",   "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/sixproxy/rulesets/refs/heads/main/rule/wx_shortvideo.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-douyin",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/sixproxy/rulesets/refs/heads/main/rule/douyin.srs", "download_detour": "DirectConn" },
      { "tag": "geosite-paypal",          "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/MetaCubeX/meta-rules-dat/sing/geo/geosite/paypal.srs", "download_detour": "DirectConn"},
      { "tag": "geosite-hok",             "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.github.com/sixproxy/rulesets/refs/heads/main/rule/hok.srs", "download_detour": "DirectConn"}
    ]
  }
}